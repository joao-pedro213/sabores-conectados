version: 3

vars:
  ENV_FILE_LOCAL: "local.env"
  APP_SERVICE: "backend"
  DB_SERVICE: "database"

tasks:
  run:
    desc: "Executa uma build limpa da aplicação e inicia todos os containers Docker definidos."
    cmds:
      - task build
      - task docker-up

  build:
    desc: "Executa uma build limpa da aplicação."
    cmds:
      - "./gradlew clean"
      - "./gradlew build -x test"

  docker-up:
    desc: "Inicia todos os containers Docker definidos."
    cmds:
      - "docker compose --env-file {{.ENV_FILE_LOCAL}} build --no-cache {{.APP_SERVICE}}"
      - "docker compose --env-file {{.ENV_FILE_LOCAL}} up --detach"

  docker-up-database:
    desc: "Inicia apenas o container do banco de dados."
    cmd: "docker compose up --detach {{.DB_SERVICE}}"

  docker-down:
    desc: "Para todos os containers Docker."
    cmd: "docker compose down"

  show-backend-logs:
    desc: "Mostra os logs do container da aplicação."
    cmd: "docker compose logs --follow {{.APP_SERVICE}}"

  show-database-logs:
    desc: "Mostra os logs do container do banco de dados."
    cmd: "docker compose logs --follow {{.DB_SERVICE}}"
